# Лучшии практики ведения API спецификации (OpenAPI) в Surf

В этом репозитории находится пример спецификации (папка example) и описаны правила работы с ней. 

## Общие принципы

- Спецификация должна быть побита на разные файлы. Это **необходимо** для того, чтобы ее можно было легко и приятно поддерживать (дополнять, изменять) и вообще читать. 
- Корневой README.md должен содержать информацию о том, как работать с источниками в репозитории. Потому что кто-то может быть не в курсе. 
- Хорошо иметь скрипт для автогенерации шаблона. Чтоб не копипастить каждый раз самим. 
- Старайтесь использовать текстовый формат (не используйте GUI), потому что так проще навигировать. И так можно пользоваться поиском. 
- Относитесь к спецификации как к программному коду. Иначе в конечном итоге она превратится в мусор. 

## Организация файлов и папок

Хорошо придерживаться следующего паттерна:
```
- root_folder <- корень вашего репозитория
  -- README.md
  -- feature_or_api_controller <- папка, имеющая название фичи
    --- api.yaml        <- Файл исключительно для описание сервисов (path в Swagger)
    --- models.yaml     <- Файл исключительно для описания моделей (components/schemas в Swagger)
    --- parameters.yaml <- Файл исключительно для описания параметров api-методов (components/parameters в Swagger)
    --- errors.yaml     <- Файл исключительно для описания ошибок которые могут вернуть методы (components/schemas в Swagger)  
```

**ВАЖНО**

- `api.yaml` и `models.yaml` обязательны! Потому что в противном случае люди будут бояться лезть менять ваши файлы. 
- `parameters.yaml` и `errors.yaml` не обязательны! Они могут быть использованы в тех случаях, когда сервисы содержат очень много повторяющихся параметров и/или ошибок. 
- Не стоит выносить отдельно components/requestBodies , потому что тогда, чтобы добраться от метода до модели, потребуется 2 перехода. Это уже неудобно. 

## Автогенерация

Хорошо иметь какой-то инструмент, который позволит сгенерить нужные файлы с предзаполненной мета информацией - чтоб люди не писали по 100 раз одно и то же. 

В этом репозитории это сделано с помощью шелл-скрипта [gen.sh](./gen.sh) и двух файлов с шаблонами [.api_template](./.api_template) и [.models_template](./.models_template)

Сам скрипт позволяет сгенерировать "контроллер" с отдельным файлом для моделек и отдельным файлом для методов API. 

Например, если вы хотите начать разрабатывать спецификацию для фичи "каталог", то нужно написать в консоль:

```shell
sh gen.sh catalog
```

Скрипт создаст папку `catalog` и добавит в нее два файла `api.yaml` и `models.yaml` с уже заполненной шапкой. 

Если папка уже есть, то скрипт просто положит в нее два файла. 
